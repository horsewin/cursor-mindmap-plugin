* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  overflow: hidden;
  background: var(--vscode-editor-background, #1e1e1e);
  color: var(--vscode-editor-foreground, #cccccc);
  font-family: var(--vscode-font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif);
  font-size: var(--vscode-font-size, 13px);
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Toolbar */
#toolbar {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 12px;
  background: var(--vscode-titleBar-activeBackground, #3c3c3c);
  border-bottom: 1px solid var(--vscode-panel-border, #474747);
  flex-shrink: 0;
  flex-wrap: wrap;
}

#toolbar button {
  padding: 4px 10px;
  border: 1px solid var(--vscode-button-border, transparent);
  border-radius: 4px;
  background: var(--vscode-button-secondaryBackground, #3a3d41);
  color: var(--vscode-button-secondaryForeground, #cccccc);
  font-size: 12px;
  cursor: pointer;
  white-space: nowrap;
  transition: background 0.15s;
}

#toolbar button:hover {
  background: var(--vscode-button-secondaryHoverBackground, #505357);
}

#toolbar button:active {
  background: var(--vscode-button-background, #0e639c);
  color: var(--vscode-button-foreground, #ffffff);
}

#toolbar .separator {
  width: 1px;
  height: 20px;
  background: var(--vscode-panel-border, #474747);
  margin: 0 4px;
}

#toolbar .node-count {
  margin-left: auto;
  font-size: 11px;
  opacity: 0.7;
}

/* View Toggle */
.view-toggle {
  display: flex;
  gap: 0;
  border-radius: 4px;
  overflow: hidden;
  border: 1px solid var(--vscode-panel-border, #474747);
}

.view-toggle button {
  border: none !important;
  border-radius: 0 !important;
  padding: 4px 12px;
  font-size: 11px;
  opacity: 0.7;
  transition: opacity 0.15s, background 0.15s;
}

.view-toggle button.active {
  opacity: 1;
  background: var(--vscode-button-background, #0e639c) !important;
  color: var(--vscode-button-foreground, #ffffff) !important;
}

.view-toggle button:not(.active):hover {
  opacity: 0.9;
}

#btn-lock {
  font-size: 11px;
  opacity: 0.7;
  transition: opacity 0.15s, background 0.15s;
}

#btn-lock.active {
  opacity: 1;
  background: var(--vscode-statusBarItem-warningBackground, #c4710e) !important;
  color: var(--vscode-statusBarItem-warningForeground, #ffffff) !important;
}

/* Main Content */
#main-content {
  flex: 1;
  display: flex;
  overflow: hidden;
  position: relative;
}

/* Markdown Pane */
#markdown-pane {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.mode-split #markdown-pane {
  width: 40%;
  min-width: 200px;
}

.mode-preview #markdown-pane {
  display: none;
}

#editor-wrapper {
  flex: 1;
  display: flex;
  overflow: hidden;
  position: relative;
}

#line-numbers {
  width: 40px;
  flex-shrink: 0;
  padding: 12px 8px 12px 0;
  background: var(--vscode-editor-background, #1e1e1e);
  color: var(--vscode-editorLineNumber-foreground, #858585);
  font-family: var(--vscode-editor-font-family, 'Menlo', 'Monaco', 'Courier New', monospace);
  font-size: var(--vscode-editor-font-size, 13px);
  line-height: 1.6;
  text-align: right;
  overflow: hidden;
  user-select: none;
  pointer-events: none;
  white-space: pre;
}

#editor-highlight-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

#highlight-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 12px 16px 12px 8px;
  font-family: var(--vscode-editor-font-family, 'Menlo', 'Monaco', 'Courier New', monospace);
  font-size: var(--vscode-editor-font-size, 13px);
  line-height: 1.6;
  tab-size: 2;
  white-space: pre;
  overflow: hidden;
  color: transparent;
  pointer-events: none;
}

#highlight-backdrop mark {
  background: rgba(234, 179, 8, 0.35);
  color: transparent;
  border-radius: 2px;
}

#highlight-backdrop mark.current {
  background: rgba(234, 179, 8, 0.7);
}

#markdown-editor {
  position: relative;
  width: 100%;
  height: 100%;
  resize: none;
  border: none;
  outline: none;
  padding: 12px 16px 12px 8px;
  background: transparent;
  color: var(--vscode-editor-foreground, #cccccc);
  font-family: var(--vscode-editor-font-family, 'Menlo', 'Monaco', 'Courier New', monospace);
  font-size: var(--vscode-editor-font-size, 13px);
  line-height: 1.6;
  tab-size: 2;
  white-space: pre;
  overflow: auto;
}

#markdown-editor:focus {
  outline: none;
}

/* Search Bar */
#search-bar {
  padding: 4px 8px;
  background: var(--vscode-editorWidget-background, #252526);
  border-bottom: 1px solid var(--vscode-panel-border, #474747);
  flex-shrink: 0;
}

#search-bar .search-row {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 2px 0;
}

#search-bar input {
  flex: 1;
  min-width: 0;
  padding: 3px 6px;
  border: 1px solid var(--vscode-input-border, #3c3c3c);
  background: var(--vscode-input-background, #3c3c3c);
  color: var(--vscode-input-foreground, #cccccc);
  font-size: 12px;
  outline: none;
}

#search-bar input:focus {
  border-color: var(--vscode-focusBorder, #007fd4);
}

#search-bar button {
  padding: 2px 6px;
  border: none;
  background: var(--vscode-button-secondaryBackground, #3a3d41);
  color: var(--vscode-button-secondaryForeground, #cccccc);
  font-size: 12px;
  cursor: pointer;
  border-radius: 2px;
}

#search-bar button:hover {
  background: var(--vscode-button-secondaryHoverBackground, #45494e);
}

#search-count {
  font-size: 11px;
  color: var(--vscode-descriptionForeground, #858585);
  min-width: 50px;
  text-align: center;
}

/* Divider */
#divider {
  width: 4px;
  cursor: col-resize;
  background: var(--vscode-panel-border, #474747);
  flex-shrink: 0;
  transition: background 0.15s;
}

#divider:hover,
#divider.dragging {
  background: var(--vscode-focusBorder, #0078d4);
}

.mode-preview #divider {
  display: none;
}

/* Canvas */
#canvas-container {
  flex: 1;
  overflow: hidden;
  cursor: grab;
  position: relative;
}

#canvas-container.panning {
  cursor: grabbing;
}

#mindmap-svg {
  width: 100%;
  height: 100%;
}

/* Node styles */
.mm-node rect {
  stroke-width: 1.5;
  transition: stroke-width 0.15s, opacity 0.15s;
}

.mm-node text {
  fill: var(--vscode-editor-foreground, #cccccc);
  pointer-events: none;
  user-select: none;
}

.mm-node.selected rect {
  stroke-width: 2.5;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { stroke-opacity: 1; }
  50% { stroke-opacity: 0.5; }
}

.mm-node:hover rect {
  stroke-width: 2;
  filter: brightness(1.1);
}

.mm-node.depth-0 rect {
  rx: 12;
  ry: 12;
}

.mm-node.depth-1 rect {
  rx: 8;
  ry: 8;
}

.mm-node rect {
  rx: 6;
  ry: 6;
}

/* Connection lines */
.mm-connection {
  fill: none;
  stroke-width: 2;
  opacity: 0.6;
  transition: opacity 0.15s;
}

/* Collapse indicator */
.mm-collapse-indicator {
  cursor: pointer;
  transition: opacity 0.15s;
}

.mm-collapse-indicator:hover {
  opacity: 1 !important;
}

/* Inline editor */
.mm-inline-editor {
  position: absolute;
  border: 2px solid var(--vscode-focusBorder, #0078d4);
  border-radius: 4px;
  background: var(--vscode-input-background, #3c3c3c);
  color: var(--vscode-input-foreground, #cccccc);
  padding: 2px 6px;
  font-family: var(--vscode-font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif);
  font-size: 14px;
  outline: none;
  z-index: 100;
  min-width: 80px;
}

/* Drag & Drop */
.mm-drag-ghost {
  opacity: 0.5;
  pointer-events: none;
}

.mm-drop-target rect {
  stroke: var(--vscode-focusBorder, #0078d4) !important;
  stroke-width: 3 !important;
  stroke-dasharray: 5 3;
}

/* Drag Ghost Overlay */
.mm-drag-ghost-overlay {
  position: fixed;
  z-index: 1000;
  pointer-events: none;
  padding: 4px 12px;
  border-radius: 6px;
  background: var(--vscode-editor-background, #1e1e1e);
  color: var(--vscode-editor-foreground, #cccccc);
  border: 2px solid var(--vscode-focusBorder, #0078d4);
  font-size: 13px;
  opacity: 0.85;
  white-space: nowrap;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  transform: translate(-50%, -120%);
}

/* Drop Indicator */
.mm-drop-indicator-line {
  stroke: var(--vscode-focusBorder, #0078d4);
  stroke-width: 2;
  stroke-dasharray: 6 3;
  pointer-events: none;
}

.mm-drop-indicator-dot {
  fill: var(--vscode-focusBorder, #0078d4);
  pointer-events: none;
}

/* Image Thumbnail */
.mm-node-image {
  pointer-events: none;
}

.mm-image-placeholder {
  fill: var(--vscode-editor-background, #2d2d2d);
  stroke: var(--vscode-panel-border, #474747);
  stroke-width: 1;
  stroke-dasharray: 4 2;
}

/* Branch colors palette */
.branch-color-0 { --branch-color: #4fc3f7; }
.branch-color-1 { --branch-color: #81c784; }
.branch-color-2 { --branch-color: #ffb74d; }
.branch-color-3 { --branch-color: #e57373; }
.branch-color-4 { --branch-color: #ba68c8; }
.branch-color-5 { --branch-color: #4dd0e1; }
.branch-color-6 { --branch-color: #aed581; }
.branch-color-7 { --branch-color: #ff8a65; }

/* Context Menu */
.context-menu {
  position: fixed;
  z-index: 1000;
  min-width: 180px;
  background: var(--vscode-menu-background, #252526);
  color: var(--vscode-menu-foreground, #cccccc);
  border: 1px solid var(--vscode-menu-border, #454545);
  border-radius: 5px;
  padding: 4px 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35);
  font-size: 12px;
}

.context-menu-item {
  padding: 6px 20px;
  cursor: pointer;
  white-space: nowrap;
  transition: background 0.1s;
}

.context-menu-item:hover {
  background: var(--vscode-menu-selectionBackground, #094771);
  color: var(--vscode-menu-selectionForeground, #ffffff);
}

.context-menu-item.disabled {
  opacity: 0.4;
  cursor: default;
  pointer-events: none;
}

.context-menu-separator {
  height: 1px;
  background: var(--vscode-menu-separatorBackground, #454545);
  margin: 4px 0;
}
